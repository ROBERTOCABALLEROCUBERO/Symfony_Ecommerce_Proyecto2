{% extends 'base.html.twig' %}

{% block title %}Productos
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function() {
            $('form#pregunta-form').on('submit', function(event) {
                event.preventDefault();

                var formData = $(this).serialize();

                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function(response) {
                        // Agregar el código necesario para mostrar la pregunta en la página sin tener que recargarla.
                        $('#lista-preguntas').append(response);
                        $('#pregunta-form')[0].reset();
                    }
                });
            });
        });
    </script>
{% endblock %}

{% block body %}
	<div class="container">
		<div class="row">
			<div class="col-md-4">
				<img src="{{ producto.fotoprod }}" class="img-fluid" alt="Foto del producto">
			</div>
			<div class="col-md-8">
				<h5 class="mt-3">{{ producto.nombreProd }}</h5>
				<p class="mt-3">
					<strong>Genero:</strong>
					{{ producto.genero }}
					<br>
					<strong>Precio:</strong>
					{{ producto.precio }}
					<br>
					<strong>Descuento:</strong>
					{{ producto.descuento }}
					<br>
					<strong>Talla:</strong>
					{{ producto.talla }}
					<br>
					<strong>Tipo:</strong>
					{{ producto.tipo }}
				</p>
				<form action="{{ path('app_carrito', {'id': producto.id}) }}" method="post" class="form-inline mt-3">
					<div class="form-group mr-3">
						<label for="cantidad">Cantidad:</label>
						<input type="number" class="form-control" id="cantidad" name="cantidad" min="1" max="{{ producto.cantidad }}" value="1">
					</div>
					<input type="submit" class="btn btn-primary" value="Agregar al carrito">
				</form>
				{% if is_granted('ROLE_USER') %}
					<form action="{{ path('app_preguntas', {'id': producto.id}) }}" id="pregunta-form" method="post">
						<div class="form-group">
							<label for="pregunta">Deja una pregunta:</label>
							<textarea class="form-control" id="pregunta" name="pregunta" rows="3"></textarea>
						</div>
						<input type="submit" class="btn btn-primary" value="Enviar">
					</form>
					<ul id="lista-preguntas">
						{# Aquí se mostrarán las preguntas mediante AJAX #}
					</ul>
				{% endif %}
			</div>
		</div>
	</div>

	{% if is_granted('ROLE_ADMIN') %}
		{{ include('productos/_delete_form.html.twig') }}
	{% endif %}
	<!-- MA Boton para borrar producto admin -->

	{% if is_granted('ROLE_ADMIN') %}
		<!-- Alex si es un usuario registrado y hay una pregunta del producto se motrara el código -->
		{{ include('productos/_delete_form.html.twig') }}

	{% endif %}

	
{% endblock %}
